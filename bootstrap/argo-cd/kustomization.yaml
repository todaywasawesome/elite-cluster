apiVersion: kustomize.config.k8s.io/v1beta1
configMapGenerator:
- name: argocd-cm
  behavior: merge
  # files:
  # - kustomize-buildoptions.yaml
  literals:
  # - "kustomize.buildOptions= --enable-helm"
  - |
    repository.credentials=- passwordSecret:
        key: git_token
        name: autopilot-secret
      url: https://github.com/
      usernameSecret:
        key: git_username
        name: autopilot-secret
  - |
    configManagementPlugins=- name: kustomize-build-with-helm
      generate:
        command: [ "sh", "-c" ]
        args: [ "kustomize build --enable-helm" ]
kind: Kustomization
namespace: argocd
resources:
- github.com/argoproj-labs/argocd-autopilot/manifests/base?ref=v0.3.1
patches:
- exposeservice.yaml
# generators:
# - kustomize-buildoptions.yaml